<div class="dashboard">
  <div class="dashboard__container">
    <app-header></app-header>

    <app-filter-bar
      *ngIf="filterBarData$ | async as filterData"
      [filters]="filterData.filters"
      (filtersChange)="onFiltersChange($event)"
      [countries]="filterData.countries"
      [activities]="filterData.activities"
      [emissionTypes]="filterData.emissionTypes"
      [yearRange]="filterData.yearRange"
      [emissionsRange]="filterData.emissionsRange"
    ></app-filter-bar>

    <div class="dashboard__stats">
      <app-stat-card
        *ngIf="aggregatedData$ | async as aggData"
        title="Total Emissions"
        [value]="aggData.totalEmissions"
        subtitle="Megatonnes (Mt)"
        [delay]="150"
      >
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </app-stat-card>

      <app-stat-card
        *ngIf="aggregatedData$ | async as aggData"
        title="Average per Record"
        [value]="aggData.averageEmissions"
        subtitle="Mt per entry"
        [delay]="200"
      >
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
        </svg>
      </app-stat-card>

      <app-stat-card
        *ngIf="aggregatedData$ | async as aggData"
        title="Highest Single Record"
        [value]="aggData.maxEmission ? aggData.maxEmission.emissions : 0"
        [subtitle]="aggData.maxEmission ? aggData.maxEmission.country + ' - ' + aggData.maxEmission.year : '-'"
        [delay]="250"
      >
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
        </svg>
      </app-stat-card>

      <app-stat-card
        *ngIf="data$ | async as data"
        title="Data Points"
        [value]="data.length"
        subtitle="Total records"
        [delay]="300"
      >
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
        </svg>
      </app-stat-card>
    </div>

    <ng-container *ngIf="aggregatedData$ | async as aggData">
      <div class="dashboard__charts">
        <app-emissions-line-chart
          [data]="aggData.emissionsByYear"
        ></app-emissions-line-chart>

        <app-emissions-by-country-chart
          [data]="aggData.emissionsByCountry"
        ></app-emissions-by-country-chart>
      </div>
    </ng-container>

    <div class="dashboard__table">
      <app-emissions-table
        *ngIf="data$ | async as data"
        [data]="data"
      ></app-emissions-table>
    </div>

    <footer class="dashboard__footer" [style.animation-delay]="'500ms'">
      <p>Built with Angular, TypeScript & Chart.js</p>
      <p>GHG Emissions Visualization Dashboard Â© 2024</p>
    </footer>
  </div>
</div>
