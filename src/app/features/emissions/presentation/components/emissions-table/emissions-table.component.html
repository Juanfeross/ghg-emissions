<div class="table-card" [style.animation-delay]="'400ms'">
  <div class="table-card__header">
    <h3 class="table-card__title">Detailed Emissions Data</h3>
    <button
      *ngIf="hasTableFilters"
      type="button"
      (click)="clearTableFilters()"
      class="table-card__clear-filters"
    >
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
      Clear Filters
    </button>
  </div>

  <div class="table-card__filters">
    <div class="table-filters">
      <div class="table-filters__search">
        <app-input
          type="text"
          placeholder="Search..."
          [value]="tableFilters.search"
          (valueChange)="onSearchChange($event)"
          className="table-filters__search-input"
        ></app-input>
      </div>

      <div class="table-filters__groups" [class.table-filters__groups--expanded]="isFiltersExpanded">
        <div class="table-filters__group">
          <label class="table-filters__label">Filter by Country</label>
          <div class="table-filters__chips">
            <button
              *ngFor="let country of uniqueCountries"
              type="button"
              (click)="toggleCountry(country)"
              class="table-filters__chip"
              [class.table-filters__chip--active]="tableFilters.countries.includes(country)"
            >
              {{ country }}
            </button>
          </div>
        </div>

        <div class="table-filters__group">
          <label class="table-filters__label">Filter by Type</label>
          <div class="table-filters__chips">
            <button
              *ngFor="let type of uniqueTypes"
              type="button"
              (click)="toggleType(type)"
              class="table-filters__chip"
              [class.table-filters__chip--active]="tableFilters.types.includes(type)"
            >
              {{ type }}
            </button>
          </div>
        </div>

        <div class="table-filters__group">
          <label class="table-filters__label">Filter by Activity</label>
          <div class="table-filters__chips">
            <button
              *ngFor="let activity of uniqueActivities"
              type="button"
              (click)="toggleActivity(activity)"
              class="table-filters__chip"
              [class.table-filters__chip--active]="tableFilters.activities.includes(activity)"
            >
              {{ activity }}
            </button>
          </div>
        </div>

        <div class="table-filters__group">
          <label class="table-filters__label">Year Range</label>
          <div class="table-filters__year-range">
            <app-input
              type="number"
              [placeholder]="'From: ' + yearRange[0]"
              [value]="tableFilters.yearFrom || ''"
              [min]="yearRange[0]"
              [max]="yearRange[1]"
              (valueChange)="onYearFromChange($event)"
              className="table-filters__year-input"
            ></app-input>
            <span class="table-filters__year-separator">-</span>
            <app-input
              type="number"
              [placeholder]="'To: ' + yearRange[1]"
              [value]="tableFilters.yearTo || ''"
              [min]="yearRange[0]"
              [max]="yearRange[1]"
              (valueChange)="onYearToChange($event)"
              className="table-filters__year-input"
            ></app-input>
          </div>
        </div>
      </div>
    </div>

    <button type="button" class="table-filters__toggle" (click)="toggleFiltersExpand()">
      <span>{{ isFiltersExpanded ? 'Show Less' : 'Show More' }}</span>
      <svg
        class="table-filters__toggle-icon"
        [class.table-filters__toggle-icon--expanded]="isFiltersExpanded"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
    </button>
  </div>

  <div class="table-card__content">
    <table class="emissions-table" role="table" aria-label="Emissions data table">
      <thead>
        <tr class="emissions-table__header-row">
          <th>
            <button
              type="button"
              (click)="setSortBy('year')"
              class="emissions-table__sort-button"
              [attr.aria-label]="tableFilters.sortBy === 'year' ? 'Year column, sorted ' + tableFilters.sortOrder : 'Sort by year'"
              [attr.aria-sort]="tableFilters.sortBy === 'year' ? (tableFilters.sortOrder === 'asc' ? 'ascending' : 'descending') : 'none'"
              (keydown.enter)="setSortBy('year')"
              (keydown.space)="setSortBy('year'); $event.preventDefault()"
            >
              Year
              <svg
                *ngIf="tableFilters.sortBy === 'year'"
                class="emissions-table__sort-icon"
                [class.emissions-table__sort-icon--desc]="tableFilters.sortOrder === 'desc'"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
              </svg>
            </button>
          </th>
          <th>
            <button
              type="button"
              (click)="setSortBy('country')"
              class="emissions-table__sort-button"
              [attr.aria-label]="tableFilters.sortBy === 'country' ? 'Country column, sorted ' + tableFilters.sortOrder : 'Sort by country'"
              [attr.aria-sort]="tableFilters.sortBy === 'country' ? (tableFilters.sortOrder === 'asc' ? 'ascending' : 'descending') : 'none'"
              (keydown.enter)="setSortBy('country')"
              (keydown.space)="setSortBy('country'); $event.preventDefault()"
            >
              Country
              <svg
                *ngIf="tableFilters.sortBy === 'country'"
                class="emissions-table__sort-icon"
                [class.emissions-table__sort-icon--desc]="tableFilters.sortOrder === 'desc'"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
              </svg>
            </button>
          </th>
          <th>
            <button
              type="button"
              (click)="setSortBy('activity')"
              class="emissions-table__sort-button"
              [attr.aria-label]="tableFilters.sortBy === 'activity' ? 'Activity column, sorted ' + tableFilters.sortOrder : 'Sort by activity'"
              [attr.aria-sort]="tableFilters.sortBy === 'activity' ? (tableFilters.sortOrder === 'asc' ? 'ascending' : 'descending') : 'none'"
              (keydown.enter)="setSortBy('activity')"
              (keydown.space)="setSortBy('activity'); $event.preventDefault()"
            >
              Activity
              <svg
                *ngIf="tableFilters.sortBy === 'activity'"
                class="emissions-table__sort-icon"
                [class.emissions-table__sort-icon--desc]="tableFilters.sortOrder === 'desc'"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
              </svg>
            </button>
          </th>
          <th>
            <button
              type="button"
              (click)="setSortBy('type')"
              class="emissions-table__sort-button"
              [attr.aria-label]="tableFilters.sortBy === 'type' ? 'Type column, sorted ' + tableFilters.sortOrder : 'Sort by type'"
              [attr.aria-sort]="tableFilters.sortBy === 'type' ? (tableFilters.sortOrder === 'asc' ? 'ascending' : 'descending') : 'none'"
              (keydown.enter)="setSortBy('type')"
              (keydown.space)="setSortBy('type'); $event.preventDefault()"
            >
              Type
              <svg
                *ngIf="tableFilters.sortBy === 'type'"
                class="emissions-table__sort-icon"
                [class.emissions-table__sort-icon--desc]="tableFilters.sortOrder === 'desc'"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
              </svg>
            </button>
          </th>
          <th class="text-right">
            <button
              type="button"
              (click)="setSortBy('emissions')"
              class="emissions-table__sort-button emissions-table__sort-button--right"
              [attr.aria-label]="tableFilters.sortBy === 'emissions' ? 'Emissions column, sorted ' + tableFilters.sortOrder : 'Sort by emissions'"
              [attr.aria-sort]="tableFilters.sortBy === 'emissions' ? (tableFilters.sortOrder === 'asc' ? 'ascending' : 'descending') : 'none'"
              (keydown.enter)="setSortBy('emissions')"
              (keydown.space)="setSortBy('emissions'); $event.preventDefault()"
            >
              Emissions (Mt)
              <svg
                *ngIf="tableFilters.sortBy === 'emissions'"
                class="emissions-table__sort-icon"
                [class.emissions-table__sort-icon--desc]="tableFilters.sortOrder === 'desc'"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
              </svg>
            </button>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let item of paginatedData; let i = index"
          class="emissions-table__body-row"
          role="row"
          [attr.aria-rowindex]="i + 1"
        >
          <td class="font-medium" role="gridcell">{{ item.year }}</td>
          <td role="gridcell">{{ item.country }}</td>
          <td role="gridcell">{{ item.activity }}</td>
          <td role="gridcell">
            <app-badge variant="outline" [className]="getEmissionTypeBadgeClass(item.emission_type)">
              {{ item.emission_type }}
            </app-badge>
          </td>
          <td class="text-right font-mono font-medium" role="gridcell">
            {{ item.emissions.toFixed(2) }}
          </td>
        </tr>
        <tr *ngIf="paginatedData.length === 0" class="emissions-table__empty-row" role="row">
          <td colspan="5" class="emissions-table__empty-cell" role="gridcell">
            <app-empty-state
              title="No data found"
              message="Try adjusting your filters to see more results."
              icon="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            ></app-empty-state>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="table-card__pagination">
    <div class="pagination-info">
      Showing {{ startItem }}-{{ endItem }} of {{ sortedDataLength }} record{{ sortedDataLength !== 1 ? 's' : '' }}
    </div>
    <div class="pagination-controls" *ngIf="totalPages > 1">
      <button
        class="pagination-button"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        type="button"
      >
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      <div class="pagination-pages">
        <button
          *ngFor="let page of getPageNumbers(); let i = index"
          class="pagination-button pagination-button--page"
          [class.pagination-button--active]="page === currentPage"
          (click)="page !== null && goToPage(page)"
          [disabled]="page === null"
          type="button"
        >
          {{ page !== null ? page : '...' }}
        </button>
      </div>
      <button
        class="pagination-button"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        type="button"
      >
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
    </div>
  </div>
</div>
